/*
 * gauge
 *
 * gauge widget
 *
 * (c) 2015 Alexandra Shatalina
 * License: MIT
 */
!function(){function t(t,i){function s(t,i){return void 0===t||null==t?i:t}var e,h;return this.canvas=t,void 0===this.canvas||null==t?this.error="Canvas is undefined":this.canvas.getContext||(this.error="Canvas is unsupported"),null!=this.error?void console.error(this.error):(this.ctx=this.canvas.getContext("2d"),this.radius=this.canvas.width<=this.canvas.height?this.canvas.width/2:this.canvas.height/2,this.ctx.translate(this.radius,this.canvas.height/2),this.arcColor=s(i.arcColor,"gray"),this.pointerColor=s(i.pointerColor,"#07c"),this.cautionColor=s(i.cautionColor,"#ffcc00"),this.dangerColor=s(i.dangerColor,"red"),this.lineWidth=s(i.lineWidth,4),this.fontSize=s(i.fontSize,10),this.contextAngle=null,this.mainRadius=this.radius-this.fontSize,this.marksRadiusEnd=this.mainRadius-10,this.marksRadiusStart=this.marksRadiusEnd-5,this.arcRadius=this.marksRadiusStart-2*this.lineWidth,this.pointerRadius=this.arcRadius-this.lineWidth,e=s(i.arcAngle,200)-180,h=n(e/2),this.startAngle=Math.PI-h,this.endAngle=h,void(this.totalAngle=2*Math.PI-this.startAngle+this.endAngle))}function i(t,i){return t*Math.cos(i)}function s(t,i){return t*Math.sin(i)}function n(t){return t*Math.PI/180}function e(t){return Math.max.apply(null,t)}t.prototype.getPointAngle=function(t){return void 0===t||null==t||null==this.maxValue?this.startAngle:this.startAngle+this.totalAngle*(t/this.maxValue)},t.prototype.setContextAngle=function(t){null==this.error&&(null!=this.contextAngle&&this.ctx.rotate(-this.contextAngle),null!=t&&(this.contextAngle=t,this.ctx.rotate(this.contextAngle)))},t.prototype.renderArc=function(t,i,s){null==this.error&&(this.ctx.beginPath(),this.ctx.arc(0,0,this.arcRadius,t,i,!1),this.ctx.lineWidth=this.lineWidth,this.ctx.strokeStyle=s,this.ctx.stroke())},t.prototype.render=function(t,n,h,r){if(null==this.error){this.setContextAngle(0),this.ctx.clearRect(-this.radius,-this.canvas.height/2,this.canvas.width,this.canvas.height);var o,a,l,c,u,d,x,g;if(l=t.length,l>1&&(0!==t[0]&&(t.unshift(0),l++),l>2&&(this.maxValue=e(t),void 0!==h&&null!=h&&(a=this.getPointAngle(h),this.renderArc(a,this.endAngle,this.dangerColor)),void 0!==n&&null!=n&&(void 0===h||h>n)&&(o=this.getPointAngle(n),this.renderArc(o,void 0===a?this.endAngle:a,this.cautionColor)))),this.renderArc(this.startAngle,void 0!==o?o:void 0!=a?a:this.endAngle,this.arcColor),l>1)for(var v=0;l>v;v++){c=this.getPointAngle(t[v]),u=i(this.marksRadiusStart,c),d=s(this.marksRadiusStart,c),x=i(this.marksRadiusEnd,c),g=s(this.marksRadiusEnd,c),this.ctx.beginPath(),this.ctx.lineWidth=1,this.ctx.strokeStyle=this.arcColor,this.ctx.moveTo(u,d),this.ctx.lineTo(x,g),this.ctx.stroke();var f=i(this.mainRadius,c),A=s(this.mainRadius,c);this.ctx.font=this.fontSize+"pt Arial",this.ctx.fillStyle=this.arcColor,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t[v].toString(),f,A)}void 0!==r&&null!=r&&this.renderValue(r)}},t.prototype.renderValue=function(t){null==this.error&&(null!=this.currentValue&&this.removePointer(),this.currentValue=t,this.ctx.beginPath(),this.ctx.arc(0,0,5,0,2*Math.PI,!1),this.ctx.fillStyle=this.pointerColor,this.ctx.fill(),this.setContextAngle(this.getPointAngle(this.currentValue)),this.ctx.beginPath(),this.ctx.fillStyle=this.pointerColor,this.ctx.moveTo(0,3),this.ctx.lineTo(this.pointerRadius,0),this.ctx.lineTo(0,-3),this.ctx.closePath(),this.ctx.fill())},t.prototype.removePointer=function(){null==this.error&&(this.ctx.beginPath(),this.ctx.arc(0,0,this.pointerRadius,0,2*Math.PI,!1),this.ctx.fillStyle="white",this.ctx.fill())},window.Gauge=t}();
